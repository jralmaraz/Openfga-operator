apiVersion: v1
kind: Secret
metadata:
  name: dsv-config
  namespace: openfga-system
  labels:
    app.kubernetes.io/name: dsv-injector
    app.kubernetes.io/component: secrets-management
type: Opaque
stringData:
  server: "https://vault.company.com"
  clientId: "placeholder-client-id"
  clientSecret: "placeholder-client-secret"
  # Replace with actual values in production
---
apiVersion: v1
kind: Secret
metadata:
  name: dsv-injector-certs
  namespace: openfga-system
  labels:
    app.kubernetes.io/name: dsv-injector
    app.kubernetes.io/component: secrets-management
type: kubernetes.io/tls
data:
  tls.crt: # Generated TLS certificate for webhook
  tls.key: # Generated TLS private key for webhook
  # These should be generated using cert-manager or manual certificate creation
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: dsv-injector-config
  namespace: openfga-system
  labels:
    app.kubernetes.io/name: dsv-injector
    app.kubernetes.io/component: secrets-management
data:
  config.yaml: |
    secretMappings:
      postgres-credentials:
        path: "/databases/openfga-postgres"
        secrets:
          username: "username"
          password: "password"
      mysql-credentials:
        path: "/databases/openfga-mysql"
        secrets:
          username: "username"
          password: "password"
          root-password: "root-password"
      openfga-secrets:
        path: "/applications/openfga"
        secrets:
          jwt-secret: "jwt-secret"
          encryption-key: "encryption-key"
          api-token: "api-token"
      keycloak-secrets:
        path: "/identity/keycloak"
        secrets:
          admin-password: "admin-password"
          db-password: "db-password"
    defaultTTL: "24h"
    refreshInterval: "1h"
    retryPolicy:
      maxRetries: 3
      retryDelay: "5s"
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: dsv-injector-cert
  namespace: openfga-system
  labels:
    app.kubernetes.io/name: dsv-injector
    app.kubernetes.io/component: secrets-management
spec:
  secretName: dsv-injector-certs
  issuerRef:
    name: ca-issuer
    kind: ClusterIssuer
  commonName: dsv-injector.openfga-system.svc
  dnsNames:
  - dsv-injector
  - dsv-injector.openfga-system
  - dsv-injector.openfga-system.svc
  - dsv-injector.openfga-system.svc.cluster.local